# 重新认识QRCode

## QRCode是什么？

QRCode是用某种特定的几何图形按一定规律在二维方向上分布的黑白相间的小方块记录数据符号信息的，最少有**21**行和**21**列，最多有**177**行和**177**列，也就是最多有31329个小方块，可以存储约**3KB**的数据。然而，QRCode的标准中共有**40**种预设的大小（21、25、…、177），并不允许你随意地组合小方块来生成。

如果一个QRCode包含的数据越多，那么这个QRCode看起来会更加拥挤。QRCode除了会存储真正的数据之外，还会存储一些结构信息，比如定位、次数、对齐、格式等信息。另外，还包括一些错误纠正的信息。

## QRCode可以存储多少数据？

QRCode最多可以存储3KB的数据，但是它究竟能存储多少长度的数字和字母呢？

当创建一个QRCode时，可以选择数据的编码以及数据的种类，这对于QRCode实际上能够存储多少长度的字符是会产生很大影响的。

| 数据种类 | 存储能力 |
| :-- | :-- |
| 只有数字 | 最多7089个字符 |
| 字母和数字 | 最多4296个字符 |
| 二进制 | 最多2953个字符 |

除了常规的QRCode之外，还有MicroQRCode、iQRCode等，它们分别用来存储很少（35位数字）、很多（40000位数字）的数据。

## QRCode一定是黑白的吗？

虽然常见的QRCode都是黑白的，但实际上，QRCode可以包括超过2种的任意颜色。可以这样理解，QRCode中的小方块分为两种，前景方块（黑色类）和背景方块（白色类），对于一个QRCode扫描器来说，其需要能够分辨这两类方块。这意味着，可以设计丰富多彩的QRCode。

一般，QRCode扫描器在扫描到QRCode时，会对扫描到的QRCode消去颜色（灰度处理），以得到容易分辨的前景、背景方块。

## QRCode可以旋转吗？

每一个QRCode都包括**3**个查找图案和**1**个对齐图案，3个查找图案分别位于3个角落，而对齐图案位于第4个角落（经常是右下角），这种设计可以方便地帮助QRCode扫描器确定正确的处理方法。

## QRCode的安全性如何？

QRCode是为机器设计的，对于人来说，并不能轻易地读出QRCode所包含的信息。虽然修改一个已经存在的QRCode很简单，但是想要被修改之后的QRCode依然是可扫描的却是很难做到的。

## QRCode由哪些部分组成？

![QRCode Sections](./introduction-to-qrcode/qrcode-sections.png)

QRCode包括以下8个部分：

1. 查找图案：共3个，帮助识别正确的方向
2. 分隔符：白色的长条，用来帮助识别查找图案
3. 次数图案：用来确定每一个方块的大小，其包括的方块是黑白相间的
4. 对齐图案：共1个，帮助识别正确的方向（最小版本的QRCode没有此部分）
5. 格式信息：与分隔符相邻，用于确定错误纠正的级别
6. 数据：真正被编码的数据
7. 错误纠正：与数据类似，用于错误纠正
8. 残余位：除去数据和错误纠正之外剩下的可编码部分

## QRCode是如何进行错误纠正的？

QRCode的错误纠正决定了在怎样的损失之下，QRCode依旧是能够被有效扫描的。错误纠正是默认开启的，无法关闭，当QRCode创建时，允许声明4种级别的错误纠正：

- L[ow] - 最多7%的损失
- M[edium] - 最多15%的损失
- Q[uality] - 最多25%的损失
- H[igh] - 最多30%的损失

在不同容错能力情况下，对应可存储的最多数字长度如下表所示：

| 容错级别 | 存储数字能力 |
| :-- | :-- |
| L | 最多7089个字符 |
| M | 最多5596个字符 |
| Q | 最多3993个字符 |
| H | 最多3057个字符 |

对于MicroQRCode和iQRCode，它们支持的容错级别也与此不同，分别是3级和6级。

QRCode中的错误纠正是采用的**里德所罗门纠错算法**（RS码）。如下图所示，QRCode中有一块位置用来标记所采用的错误纠正级别。

![Error Correction](./introduction-to-qrcode/error-correction.png)

## 参考链接

- [关于QRCode你需要知道的一切](http://qrcode.meetheed.com/)
- [QRCode艺术](http://qrcode.meetheed.com/qrcode_art.php?s=s)
- [QRCode生成器](https://www.unitag.io/qrcode)
- [Wiki: 里德所罗门纠错算法](https://en.wikipedia.org/wiki/Reed%E2%80%93Solomon_error_correction)
