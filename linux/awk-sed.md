# Awk 和 Sed

Awk 和 Sed 都是强大的文本处理工具，但推荐当文本满足特定模式时使用 Sed，当文本看起来像是有规则的行列时使用 Awk。Sed 处理文本的功能十分强大，但 Awk 拥有更强的编程能力及灵活性。

## Awk

Awk 是一个强大的文本分析工具，取名来自三位创始人 Alfred Aho、Peter Weinberger 和 Brian Kernighan 的家族名称的首字母。

### Awk 的工作流程

Awk 执行的流程非常简单：读（Read）、执行（Execute）、重复（Repeat）。

- 读：Awk 从输入流（文件、管道、标准输入）中读入一行并将其存入内存中
- 执行：对于每一行输入，所有的 Awk 命令按序执行，Awk 命令默认针对一行输入
- 重复：重复上面两个过程直到文件结束

### Awk 程序结构

Awk 程序由开始块（Begin Block）、主体块（Body Block）和结束块（End Block）组成。

#### 开始块（Begin Block）

开始块就是在程序启动时执行的代码，在整个处理过程中只执行一次，一般情况下，会在这里初始化一些变量。`BEGIN` 是开始块的关键字，不过开始块是可选的。语法：

```awk
BEGIN {awk-commands}
```

#### 主体块（Body Block）

对于输入的每一行都会执行一次主体块的命令，但是可以限定行的模式匹配。主体块甚至也是可以省略的，但此时必须有输入的文件。语法：

```awk
/pattern/ {awk-commands}
```

#### 结束块（End Block）

结束块是程序结束时执行的代码，关键字是 `END`，也是可选的。语法：

```awk
END {awk-commands}
```

## Sed

Sed 是一种流编辑器（Stream Editor），能够完美地配合正则表达式使用，是文本处理中的利器。

### Sed 的工作流程

Sed 执行的流程非常简单：读（Read）、执行（Execute）、重复（Repeat）。

- 读：Sed 从输入流（文件、管道、标准输入）中读入一行并将其存入临时缓冲区中，称为模式空间
- 执行：对于每一行输入，所有的 Sed 命令按序执行，Sed 命令针对临时缓冲区
- 重复：重复上面两个过程直到文件结束

### Sed 命令详解

#### 命令格式

```bash
$ sed [options] 'commands' file(s)
$ sed [options] -f scriptfile file(s) # 使用指定的脚本文件来执行
```

#### 命令选项

- `-e`：使用 `commands` 脚本，可以省略
- `-f`：使用指定的脚本文件
- `-E`：使用强大的正则表达式
- `-i`：直接修改当前文件，但在不同平台下有差异，推荐将结果重定向，不适用此选项
- `-n`：取消默认的输出

#### 常用指令

- `a\`：在当前行下面插入文本，需要换行符。
- `i\`：在当前行上面插入文本，需要换行符。
- `c\`：把选定的行改为新的文本，需要换行符。
- `d`：删除选择的行。
- `D`：删除慕板块的第一行。
- `s`：替换指定字符，默认值只替换该行的第一个匹配，如果需要全部匹配，需要在模式后使用 `g`。
- `h`：拷贝模板块的内容到内存中的缓冲区。
- `H`：追加模板块的内容到内存中的缓冲区。
- `g`：获得内存缓冲区的内容，并替代当前模板块中的文本。
- `G`：获得内存缓冲区的内容，并追加到当前模板块文本的后面。
- `l`：列表不能打印字符的清单。
- `n`：读取下一个输入行，用下一个命令处理新的行而不是用第一个命令。
- `N`：追加下一个输入行到模板块后面并在二者间嵌入一个新行，改变当前行号码。
- `p`：打印模板块的行。
- `P`：（大写）打印模板块的第一行。
- `q`：退出 Sed。
- `b label`：分支到脚本中带有标记的地方，如果分支不存在则分支到脚本的末尾。
- `r file`：从 file 中读行。
- `t label`：if 分支，从最后一行开始，条件一旦满足或者 T，t 命令，将导致分支到带有标号的命令处，或者到脚本的末尾。
- `T label`：错误分支，从最后一行开始，一旦发生错误或者 T，t 命令，将导致分支到带有标号的命令处，或者到脚本的末尾。
- `w file`：写并追加模板块到 file 末尾。  
- `W file`：写并追加模板块的第一行到 file 末尾。  
- `!`：表示后面的命令对所有没有被选定的行发生作用。  
- `=`：打印当前行号码。  
- `#`：把注释扩展到下一个换行符以前。  
